# 结合健康监测与认知训练的老年陪伴机器人交互体验设计研究

## 一、项目概述

### 1. 开发总目标

本项目为工业设计专业大学生的毕业设计，旨在开发一个面向机构养老场景的多模态交互陪伴机器人系统原型，具备 "**投影式认知交互 + 非接触式健康监测 + 情感陪伴机制**" 的联动框架，产出 **基于老人状态感知的自适应交互系统**。

### 2. 核心功能与预期架构

系统采用分层架构设计，实现三个核心能力的联动：

| 层级 | 主要功能 | 核心模块 |
|------|----------|----------|
| **感知层** | 数据采集与预处理 | 平板端摄像头（生理监测）、地面交互摄像头（投影交互） |
| **状态理解层** | 状态分析与判断 | 生理状态趋势分析、情绪与参与度评估、异常行为检测 |
| **交互与决策层** | 智能决策与反馈 | 训练难度调节、情感反馈生成、状态参考输出 |

### 3. 预期实现方案

- **硬件配置**：安卓平板（前置摄像头）+ 投影仪 + 外置摄像头
- **软件架构**：前后端分离，后端Python，前端Nuxt-Vue
- **技术路径**：OpenCV (捕获) + Mediapipe (对齐) + DeepFace (分析) + Socket.IO (传输)
- **交互方式**：老人通过脚步/站位/停留与投影界面交互

## 二、系统架构与功能设计

### 1. 感知层

#### 平板端摄像头（网络摄像头）
- **功能**：rPPG心率估计 + 情绪识别 + 姿态检测 + 注意力评估
- **设备**：安卓平板（荣耀平板）或手机IP Webcam
- **默认URL**：`http://10.117.42.45:8080/video`
- **技术实现**：
  - rPPG心率估计：通过面部颜色变化提取心率信号
  - 情绪识别：Mediapipe面部网格 + DeepFace情绪分析
  - 姿态检测：上半身姿态评估与参与度分析
  - 注意力评估：眼部状态（眨眼频率、注视方向）分析

#### 地面交互摄像头（网络摄像头）
- **功能**：屏幕识别 + 认知训练互动 + 脚踩踏检测
- **设备**：外置摄像头或手机IP Webcam
- **默认URL**：`http://10.117.42.174:8080/video`
- **技术实现**：
  - 彩色区域检测：识别投影界面的交互区域
  - 手部/脚部检测：MediaPipe Hands检测交互行为
  - 交互判定：基于停留时间的交互确认

### 2. 状态理解层

#### 生理状态趋势判断
- rPPG心率监测与HRV分析
- 疲劳程度评估
- 活动量与活动节奏分析

#### 情绪与参与度变化趋势
- 多模态情绪识别（面部表情 + 姿态）
- 注意力与反应力评估
- 参与度动态监测

#### 异常或疲劳行为信号
- 异常心率检测
- 长时间静止/活动异常检测
- 疲劳与注意力下降预警

### 3. 交互与决策层

#### 认知训练参数调节
- 难度动态调整
- 节奏自适应调节
- 持续时间智能控制

#### 情感反馈方式调节
- 语音语气调整
- 鼓励/放缓/休息提示
- 个性化内容推荐

#### 状态参考信息输出
- 实时状态监测报告
- 历史数据统计与分析
- 异常状态预警

## 三、UI与交互设计

### 1. 平板端UI（2560*1600，16:10比例）

#### 主页
- 日期天气显示
- 语音通话
- 一键呼叫
- 健康、娱乐、认知三大入口
- 智能服务助手（阿康）

#### 健康板块
- 健康看板：情绪健康、睡眠健康、活动量、心率、HRV等
- 运动课程：八段锦、太极等
- 生活建议：饮食建议等

#### 娱乐板块
- 影视功能
- 音乐功能（民歌、戏曲、收音机等）
- 舞蹈功能（广场舞、交际舞）
- 报纸杂志资讯
- 回忆相册

#### 认知与学习板块
- 认知训练/游戏（色词测试、打地鼠等）
- 认知看板：训练时长、效果、趋势等
- 学习内容：园艺种植、烹饪烘焙、琴棋书画等

### 2. 投影端UI（认知训练界面）

- 通过投影仪投射到地面
- 大尺寸、低精度操作区域
- 主要显示：
  - 认知训练游戏内容
  - 交互区域（颜色块、按钮等）
  - 实时得分与进度显示

### 3. 交互方式

#### 色词测试示例
- 投影界面显示带颜色的文字（如红色的"黄"）
- 老人通过脚踩或停留选择文字颜色
- 系统实时反馈正确/错误

#### 当前硬件替代方案
- 使用电脑屏幕模拟地面投影
- 用户用手遮挡某区域≥2秒等价于"脚踩投影区域"
- 手部遮挡检测替代脚踩踏检测

## 四、技术栈

### 后端
- Python 3.10.x
- Flask（Web框架）
- OpenCV（图像处理）
- MediaPipe（姿态+手势识别）
- DeepFace（情绪识别）
- Socket.IO（实时通信）
- Scipy（信号处理）
- TensorFlow 2.15.1（深度学习推理）

### 前端
- Vue 3
- Nuxt 3
- Socket.IO Client（实时通信）
- Chart.js（数据可视化）

## 五、开发计划

### 阶段一：基础功能实现（已完成）

| 功能模块 | 实现情况 | 技术细节 |
|----------|----------|----------|
| 平板摄像头连接 | ✅ | 网络摄像头视频流获取与处理 |
| 平板摄像头处理 | ✅ | rPPG心率估计、情绪识别、姿态检测 |
| 投影摄像头连接 | ✅ | 网络摄像头视频流获取与处理 |
| 投影摄像头处理 | ✅ | 屏幕识别、手部遮挡检测 |
| 平板端主界面 | ✅ | 游戏选择、实时状态显示 |
| 平板控制界面 | ✅ | 生理状态监测、推荐行动、训练历史 |
| 投影训练界面 | ✅ | 色词游戏、交互反馈、进度显示 |
| 状态管理模块 | ✅ | 训练状态管理、数据融合 |
| 训练控制逻辑 | ✅ | 训练启动/停止、难度调节 |

### 阶段二：联动功能完善（进行中）

| 功能模块 | 计划实现 | 技术细节 |
|----------|----------|----------|
| 物理交互优化 | 🚧 | 完善手部遮挡检测，提高交互准确性 |
| 训练游戏扩展 | 🚧 | 开发更多认知训练游戏（记忆游戏、反应测试等） |
| 数据统计与分析 | 🚧 | 实现训练数据可视化与分析功能 |
| 性能优化 | 🚧 | 优化视频处理算法，提高系统响应速度 |
| 用户体验优化 | 🚧 | 添加音效反馈、动画效果等 |

### 阶段三：系统集成与测试（计划中）

| 功能模块 | 计划实现 | 技术细节 |
|----------|----------|----------|
| 硬件集成测试 | 🔄 | 投影仪与外置摄像头集成测试 |
| 系统稳定性测试 | 🔄 | 长时间运行稳定性测试 |
| 可用性测试 | 🔄 | 老年人用户测试与反馈收集 |
| 系统优化与完善 | 🔄 | 根据测试结果优化系统性能与用户体验 |

## 六、当前实现状态

### 1. 已实现功能

#### 视频处理与识别
- 平板摄像头视频流获取与处理
- rPPG心率估计
- 情绪识别（基于DeepFace）
- 姿态检测（基于MediaPipe）
- 地面交互摄像头视频流获取与处理
- 彩色区域检测
- 手部遮挡检测（替代脚踩踏）

#### 认知训练游戏
- 色词游戏实现
- 实时得分与进度显示
- 正确/错误反馈
- 难度动态调整

#### 前后端通信
- RESTful API接口实现
- Socket.IO实时通信
- 视频流传输优化

#### 数据管理
- 训练历史数据保存
- 状态数据融合与分析

### 2. 存在的问题与挑战

#### 技术问题
- 视频流延迟与卡顿问题
- 非正脸识别准确率需进一步提高
- 手部遮挡检测的准确性与稳定性

#### 功能完善
- 更多认知训练游戏的开发
- 数据统计与分析功能
- 情感反馈机制的完善

#### 硬件限制
- 暂无投影仪和外置摄像头
- 当前使用手机IP Webcam替代

## 七、下一步计划

### 1. 近期计划（1-2周）

- 优化视频处理算法，提高视频流流畅度
- 完善情绪识别算法，提高非正脸识别准确率
- 优化手部遮挡检测，提高交互准确性
- 添加更多认知训练游戏（记忆游戏、反应测试）

### 2. 中期计划（2-4周）

- 实现数据统计与分析功能
- 完善情感反馈机制
- 添加语音助手功能
- 优化UI设计，提高用户体验

### 3. 长期计划（4-8周）

- 投影仪与外置摄像头集成测试
- 老年人用户测试与反馈收集
- 系统性能优化与稳定性测试
- 最终系统集成与文档完善

## 八、硬件替代方案说明

### 当前替代方案

| 硬件 | 替代设备 | 实现方式 |
|------|----------|----------|
| 投影仪 | 电脑屏幕 | 显示投影训练界面 |
| 外置摄像头 | 手机IP Webcam | 网络摄像头视频流 |
| 脚踩踏交互 | 手部遮挡 | 手遮挡区域≥2秒触发交互 |

### 技术实现

- **手机端**：安装IP Webcam应用，设置局域网访问
- **后端**：通过OpenCV读取手机摄像头网络流
- **前端**：通过API获取摄像头处理结果和交互状态

### 连接配置

- **默认URL**：
  - 平板摄像头：`http://10.117.42.45:8080/video`
  - 投影摄像头：`http://10.117.42.174:8080/video`

## 九、技术路径与环境依赖

### 核心依赖版本

| 库名称 | 版本 | 作用描述 |
|--------|------|----------|
| Python | 3.10.x | 基础语言环境 |
| TensorFlow | 2.15.1 | 深度学习推理框架 |
| DeepFace | 0.0.97 | 情绪识别框架 |
| MediaPipe | 0.10.9 | 人脸/姿态检测 |
| OpenCV | 4.8.0.76 | 视频处理 |
| Flask-SocketIO | 5.6.0 | 实时通信 |

### 关键技术实现

1. **帧同步与零缓存策略**：设置`CAP_PROP_BUFFERSIZE = 1`，独立线程疯狂拉流并覆盖旧帧，解决视频堆积卡顿

2. **非正脸识别优化**：使用MediaPipe面部网格检测器，启用Align逻辑，先将面部"扶正"再识别

3. **双线程架构**：分离捕获线程和分析线程，确保前端画面流畅显示

4. **16:10固定布局**：所有页面采用2560*1600固定比例，确保跨设备显示一致性

## 十、项目结构

```
rppg/
├── backend/              # 后端代码
│   ├── app.py            # 主应用（双摄像头+联动逻辑）
│   ├── tablet_processor.py  # 平板摄像头处理模块
│   ├── screen_processor.py  # 外接摄像头处理模块
│   ├── state_manager.py  # 状态管理和训练逻辑
│   └── training_history.json  # 训练历史数据
├── frontend/             # 前端代码
│   ├── pages/            # 页面组件
│   │   ├── index.vue     # 平板端主界面（游戏选择）
│   │   ├── tablet.vue    # 平板控制界面
│   │   ├── judge.vue     # 外接摄像头显示界面
│   │   ├── occlusion.vue # 遮挡检测测试界面
│   │   └── training.vue  # 投影训练界面
│   ├── public/           # 静态资源
│   ├── app.vue           # 根组件
│   ├── nuxt.config.ts    # Nuxt配置
│   └── package.json      # 前端依赖
├── example/              # 示例代码（流畅情绪识别）
│   ├── backend/          # 示例后端
│   └── frontend/         # 示例前端
├── .gitignore            # Git忽略配置
├── .hintrc               # Hint配置
├── README.md             # 本文档
└── instruction.md        # 项目说明文档
```

## 十一、启动与运行

### 1. 后端启动

```bash
# 激活虚拟环境
source activate rppg

# 启动后端服务
python backend/app.py
```

### 2. 前端启动

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动前端开发服务器
npm run dev
```

### 3. 访问地址

- 平板端主界面：`http://<电脑IP>:3000/`
- 平板控制界面：`http://<电脑IP>:3000/tablet`
- 投影训练界面：`http://<电脑IP>:3000/training`

## 十二、项目总结

本项目旨在开发一个基于双摄像头感知的老年陪伴机器人系统，通过非接触式健康监测、情感陪伴和认知训练的联动，为老年人提供个性化的健康管理和认知训练服务。当前项目已完成基础功能实现，包括视频处理与识别、认知训练游戏、前后端通信和数据管理等。接下来，我们将继续优化系统性能，完善功能模块，最终实现一个稳定、高效、易用的老年陪伴机器人系统。

该项目不仅具有学术研究价值，还具有实际应用前景，能够为养老机构和家庭提供一种新的老年健康管理和认知训练方式，提高老年人的生活质量和健康水平。