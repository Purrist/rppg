# 结合健康监测与认知训练的老年陪伴机器人交互体验设计研究

## 一、项目概述

### 1. 开发总目标

本项目为工业设计专业大学生的毕业设计，旨在开发一个面向机构养老场景的多模态交互陪伴机器人系统原型，具备 "**投影式认知交互 + 非接触式健康监测 + 情感陪伴机制**" 的联动框架，产出 **基于老人状态感知的自适应交互系统**。

机器人的身体上具备一个屏幕（使用安卓平板，该平板自带一个前置的摄像头）和一个投影仪以及和投影仪放在一起的一个外置摄像头。

系统在我的电脑上运行，是一个包含前后端的项目（C:\Users\purriste\Desktop\PYProject\rppg），后端用python（D:/anaconda/envs/rppg/python.exe，环境：rppg），前端用nuxt-vue。平板上安装了ip webcam，电脑和平板置于同一个网络下，平板将前置摄像头的视频传到电脑（例如http:192.168.137.97:8080），该视频用于状态的采集，①情绪状态 ②心率（rppg）hrv③环境数据（光强、是否有人、有多少人、人与摄像头距离、人脸识别等）④人的身体状态（坐立状态、活动量、身体动作、头部动作、动作频率（行为节奏）、眼部：眨眼频率、是否注视屏幕、注视时间、游离频率、交互频率、注意力/反应力），Python获取视频后会进行处理，获得这些数据。而电脑连接的外置摄像头，会拍摄投影到地面的UI，视频传到Python，用于检测人在地面UI上的行为和位置，从而形成交互（空间互动投影）（这部分的难度在于，如何正确的识别人的位置，并与UI上交互组件位置对应）。

本研究重点关注：是否能够通过多模态感知形成**状态判断**，是否能够基于状态动态调节**交互与训练**，是否能让老人**愿意参与并持续参与**，做到无感的状态监测，以及基于状态的**主动交互**。合理设计交互的触发时机、交互的内容、交互的方式与形式，不仅做到健康和认知层面的守护，也提供情感支持。

### 2. 核心功能与预期架构

系统采用分层架构设计，实现三个核心能力的联动：

| 层级 | 主要功能 | 核心模块 |
|------|----------|----------|
| **感知层** | 数据采集与预处理 | 平板端摄像头（生理监测）、地面交互摄像头（外接、投影交互） |
| **状态理解层** | 状态分析与判断 | 生理状态趋势分析、情绪与参与度评估、异常行为检测 |
| **交互与决策层** | 智能决策与反馈 | 训练难度调节、情感反馈生成、状态参考输出 |

### 3. 预期最终实现方案

- **硬件配置**：安卓平板（带前置摄像头）+ 投影仪 + 外置摄像头
- **软件架构**：后端Python，前端Nuxt-Vue
- **交互方式**：电脑将认知游戏投影到地面，老人通过脚步/站位/停留与投影界面交互

## 二、系统架构与功能设计

### 1. 感知层

#### 平板端摄像头（网络摄像头）

- **功能**：rPPG心率估计 + 情绪识别 + 姿态检测 + 注意力评估
- **设备**：安卓平板（荣耀平板）IP Webcam
- **默认URL**：`http://192.168.137.97:8080/video`
- **技术实现**：
  - rPPG心率估计
  - 情绪识别：Mediapipe面部网格 + DeepFace情绪分析
  - 姿态检测：上半身姿态评估与参与度分析
  - 注意力评估：眼部状态（眨眼频率、注视方向）分析
  - 人体识别：是否有人，有多少人，人与设备的距离，人脸识别

#### 地面交互摄像头（外接摄像头）

- **功能**：认知训练互动中识别投影画面内的脚踩/手部遮挡动作
- **设备**：外置摄像头
- **技术实现**：
  - 彩色区域检测：识别投影界面的交互区域
  - 手部/脚部检测：MediaPipe Hands检测交互行为
  - 交互判定：基于停留时间的交互确认

#### 当前硬件替代方案

- 使用手机摄像头（ipwebcam：<http://192.168.137.113:8080/video>）代替外接摄像头，电脑屏幕模拟地面投影。
- 用户用手遮挡某区域≥2秒等价于"脚踩投影区域"
- 手部遮挡检测替代脚踩踏检测

### 2. 状态理解层

#### 生理状态趋势判断

- rPPG心率监测与HRV分析
- 疲劳程度评估
- 活动量与活动节奏分析

#### 情绪与参与度变化趋势

- 多模态情绪识别（面部表情 + 姿态）
- 注意力与反应力评估
- 参与度动态监测

#### 异常或疲劳行为信号

- 异常心率检测
- 长时间静止/活动异常检测
- 疲劳与注意力下降预警

### 3. 交互与决策层

#### 认知训练参数调节

- 难度动态调整
- 节奏自适应调节
- 持续时间智能控制

#### 情感反馈方式调节

- 语音语气调整
- 鼓励/放缓/休息提示
- 个性化内容推荐

#### 状态参考信息输出

- 实时状态监测报告
- 历史数据统计与分析
- 异常状态预警

## 三、UI与交互设计

### 1. 平板端UI（2560*1600，16:10比例）

原则：
常规平板页 (Home/Health/Learning 等)：采用 aside (侧边栏) + main (主区域) 结构，侧边栏用于全局导航。除首页外其他页面常规页面都有akon悬浮球。
强制 16:10 “死布局”：固定显示比例：全系统严格适配 16:10 物理比例（2560*1600）。
绝对无滚动原则：页面必须是“死布局”，严禁出现垂直或水平滚动条。所有内容必须在不滚动的情况下在当前视口完整呈现。
无白边/黑边原则：背景必须全填充，严禁出现因自适应导致的白边或黑色遮幅。
强制溢出隐藏：所有容器必须设置 overflow: hidden，针对 Webkit 内核必须显式隐藏滚动条。

投影页 (Projection)：严禁侧边栏，实现沉浸式投影。
开发者后台 (Developer)：严禁侧边栏。用于实时监控视觉引擎输出。
这两个页面在电脑上呈现，要求是铺满整个电脑屏幕，无侧边栏和akon悬浮球

色彩规范：旨在营造 “灵动、简洁、活力、温暖、适老化” 的氛围

核心主题色 (60%)：#FF7222 (活力橙) —— 用于 Logo、主按钮及核心品牌元素，赋予产品温暖感。

功能提示色 (15%)：

#33B555 (安全绿) —— 用于表现“情绪正向、挑战适中”等。

#FB4422 (警戒红) —— 用于表现“情绪负面、压力过载”等。

辅助色 (20%)： #FFD111 (温暖黄) & #2AAADD (清爽蓝)

点缀色 (5%)： #1DD1BB (薄荷绿) & #7555FF (极光紫)

#### UI 设计与适配方案：16:10 比例与跨平台兼容

机器人身体上的屏幕是安卓平板（2560*1600），必须严格遵循 16:10 的显示比例。同时，系统又是在电脑上开发的，必须解决在不同缩放比例（如电脑 Edge 浏览器 100% 缩放）下，UI 不会因为高度不足而导致底部信息丢失（溢出）的问题，确保排版灵动且温暖。

【可参考的解决方法】：
容器级比例锚定：在 app.vue 根组件中，我构建了一个名为 .tablet 的核心容器，利用 CSS 的 aspect-ratio: 16 / 10; 属性强制锁定比例。
视口单位（vh/vw）与 Flex 自适应布局：
解决溢出：放弃了写死像素（px）高度，转而使用 flex: 1 配合 min-height: 0。这确保了视频区域能够根据剩余空间动态收缩。
视口锁定：将整个容器高度定为 100vh，即使电脑端缩放比例改变，UI 也会在保持 16:10 的前提下自动等比例缩放，并居中显示，永远不会出现“底部字看不见”或“需要滚动条”的情况。
视频无缝填充：针对“视频窄、有黑边”的问题，使用了 object-fit: cover;。这确保了无论摄像头采集的原始比例如何，画面都会充满 16:10 的容器，提供沉浸式的视觉体验。

#### 首页

- 日期天气显示
- 语音通话
- 一键呼叫
- 健康、娱乐、认知三大入口（侧边栏）
- 智能服务助手（阿康）以完整形象+对话框形式占据页面下部，而非悬浮球形式

#### 健康板块

1.健康看板，可视化查看自己的健康状态（例如：情绪健康、睡眠健康、清醒次数、起夜、睡眠时长、睡眠分析建议、活动量、活动小时数、锻炼时长、心率、hrv、静息心率等等）
2.运动课程（八段锦、太极、羽毛球、慢跑（跑前热身、科学慢跑、跑后拉伸放松）等等）
3.生活建议（饮食建议等）

#### 娱乐板块（将老人平时看过/听过的内容融入认知训练）

1.影视功能（电视剧电影播放）

2.音乐功能（民歌、戏曲、收音机、相声、听书等）

3.舞蹈功能（广场舞、交际舞）

4.报纸杂志资讯（时政、历史、军事、小说、健康）

5.回忆相册（可能会偏重这个，与认知训练进行联动）

#### 益智（认知与学习）板块

1.认知训练/游戏（听音猜歌名、色词测试、打地鼠等）

2.认知看板（训练时长、训练效果、趋势等等）

3.学习（园艺种植、烹饪烘焙、琴棋书画、手工（织毛衣、刺绣、剪纸、折纸、串珠））

### 2. 投影端UI（认知训练界面）

- 通过投影仪投射到地面
- 大尺寸、低精度操作区域
- 主要显示：
  - 认知训练游戏内容
  - 交互区域（颜色块、按钮等）
  - 实时得分与进度显示

### 3. 认知训练游戏示例

#### 色词测试

- 投影界面显示带颜色的文字（如红色的"黄"）
- 老人通过脚踩或停留选择文字颜色
- 系统实时反馈正确/错误
  
#### 趣味打地鼠 (Whack-A-Mole)

游戏时长：单局强制固定为 60秒。
交互判定：外接摄像头识别手势在预设 ROI 区域的停留，停留满 1 秒即判定为“击中”。
地鼠逻辑：地鼠停留 2.5 秒，冷却 0.5 秒后随机出现。

## 四、技术栈

1.硬件配置

平板端：安卓平板（前置摄像头）用于生理与情绪监测。

投影端：投影仪 + 外置摄像头（当前开发阶段使用手机 IP Webcam 替代）。

2.后端技术栈 (Python 3.10.x)

核心框架：Flask + Socket.IO（threading 异步模式）。

视觉引擎：

OpenCV：基础图像捕获与 ROI 切片。

MediaPipe：Face Mesh 锁定额头 ROI（rPPG 用），Hands 用于手势/坐标识别。

DeepFace：每 0.5 秒进行一次情绪识别分析。

生理监测：基于 rPPG 技术提取绿色通道均值进行心率估计。

实时推送：后端通过 tablet_stream 和 screen_stream 实时推送 base64 图像流及生理数据。

自适应基础：系统实时记录老人情绪（Happy, Sad, Neutral 等）与心率波动，作为后续自适应调节的输入。

3.前端技术栈 (Vue 3 / Nuxt 3)

状态管理：响应式变量 (ref) 实时同步 Socket 推送的图像流与游戏状态。

组件化交互：

Akon Ball：90x90 圆形全局悬浮球，支持点击与状态反馈。

Progress Ring：SVG 环形进度条，用于投影页非接触式触发反馈。

## 五、项目结构

├── backend (系统后端)
│   ├── app.py              # 服务入口、SocketIO 线程管理与数据分发
│   ├── tablet_processor.py # 核心感知引擎 (rPPG、情绪识别、ROI 锁定)
│   ├── screen_processor.py # 投影交互处理 (手势判定、坐标映射)
│   └── games.py            # 游戏逻辑类 (WhackAMole 逻辑实现)
├── frontend (Nuxt 前端)
│   ├── pages/
│   │   ├── index.vue       # 首页 (张爷爷看板)
│   │   ├── health.vue      # 健康页
│   │   ├── entertainment.vue  # 娱乐页
│   │   ├── learning.vue    # 益智页
│   │   ├── training.vue    #游戏进行中，认知游戏控制/数据展示
│   │   ├── settings.vue
│   │   ├── projection.vue  # 投影专用全屏页 (无侧边栏)
│   │   └── developer.vue   # 开发者全屏页 (无侧边栏)
│   ├── layouts/
│   └── app.vue             # 全局布局入口 (控制侧边栏与显示区域逻辑)
└── README.md               # 本项目开发说明

## 六、当前阶段的硬件替代方案

### 硬件限制

- 暂无投影仪和外置摄像头
- 当前使用手机IP Webcam替代

#### 1. 投影交互替代方式

- 使用电脑屏幕模拟地面投影
- 在屏幕上绘制与未来投影一致的交互区域
- 用户用手遮挡某一区域 ≥ 2 秒
  - 等价于“脚踩投影区域”

对应关系：
手部遮挡 ≈ 脚部踩踏
电脑屏幕 ≈ 地面投影

#### 2. 摄像头方案

- 使用手机后置摄像头 IP Webcam
- - 识别人与投影UI（暂用电脑屏幕模拟）的交互
  - 暂时代替外接摄像头

### 连接配置

- **默认URL**：
  - 平板摄像头：`http://192.168.137.97:8080/video`
  - 投影摄像头（暂时用手机摄像头代替）：`http://192.168.137.113:8080/video`

---

## 七、项目详细要求与实现进展（持续更新中）

### 1. 三个能力必须联动，而非独立存在

本项目中的三项能力需构成闭环：

- **健康监测**：提供生理与行为状态线索
- **情感陪伴**：提供长期互动与情绪反馈机制
- **认知训练**：作为主要交互任务，并根据状态动态调整

### 2. 投影交互是主要交互方式

系统的核心交互形式为：

- 使用投影仪将认知训练界面投影到地面
- 老人通过 **脚步 / 站位 / 停留** 与投影界面交互
- 投影界面本身即为可交互空间，而非普通显示屏

### 3.视频识别与显示，必须高效、流畅、准确

视频流必须极度流畅（不能有明显延迟），且状态识别准确度要高，特别要解决侧脸、低头等非正脸/低光照、多人等复杂环境变化场景下的识别失败问题。

### 4. 我向ai提出过的要求（从过去到现在），当有矛盾的点时，以最新的要求为准

01
整体来说应该app.py是打通整个数据的接口，负责把其他py处理得到的类似【心率：65 情绪：开心 眼动：正常等等】这样的东西传给前端，可能有一个负责处理平板摄像头视频的py，这个摄像头应该是负责获得心率、情绪、是否有人，这个人是谁、眼动、运动量等信息，有一个负责处理外接摄像头的py，专门负责认知训练时的判断（是否踩到正确的按钮上，是否运动量大疲劳，等等），还要有接入语音识别api和大语言模型api的地方，负责机器人阿康的唤醒和交流。在我的设想里，机器人会记住老人平时的喜好和说过的话、体验过的娱乐内容（比如音乐、电视剧）然后把这些转化为认知训练的一部分（比如听歌猜歌名、看图片猜角色/剧名等等）。反正就是有一个智能的模型，能够完成无感采集、主动交互。能够在合适的时机，提供老人愿意接受的功能。在页面上，我希望能像一个真正的APP一样，能够适老化，呈现在我的平板上（16:10）。包含首页（一键呼叫按钮、视频通话按钮、三大板块按钮、阿康的形象和输入框、自定义选择添加的按钮/组件）、运动健康、娱乐生活、认知学习、个人账户和设置。

02
有一个人脸识别页面，有一个开发者入口（到时候我会把电脑放到一边，展位上只有“带有投影仪、外接摄像头+自带前置摄像头的平板+麦克风”，我可以在电脑上看到各个数据状态是否正常），当开始认知训练时投影仪才会开始，这时候平板上应该显示当前难度、情绪变化可视化、准确率、反应时间等等，有重新开始和结束按钮，点结束/时间到自动结束后，平板上应该呈现刚才这些数据生成的一个报告，将刚才的训练结果可视化，向老人说明我这个真的有用！
如果有个py负责阿康的主动交互的话，后续我会做调研，想出一套主动交互的规则。（比如说靠近然后注视几秒，就会说：阿康等你好久啦，有什么我能帮您？）

03
除主页外，其他页面的阿康都是悬浮球的形式，点击它或者在主页和他说话，都会从下往上弹出一个面板，进入和它交流的页面（类似手机的智能助手，不会占满整个版面，是以面板的形式，面板大小随聊天内容多少决定

04
我有一个readme.md，存放我们整个项目开发计划以及现阶段实现的内容。你每次回答都要写一段话给我来补充这个readme，像写日志一样，写我们这次实现了什么，接下来准备做什么，发生了什么错误、什么问题没解决，什么问题解决了，用什么方法解决的等等

05
在描述rppg或者你的代码里面，不要出现心率、老人、医疗、监视等可能触发aigc内容安全机制的描述

06
两种关闭面板的方法：当akon的面板弹出时，可以通过点面板之外的区域，让面板收起来。还要在面板右上角加一个关闭x更适合老人使用。
侧边栏应该这样：首页、健康、娱乐、益智，下面是用户头像和姓名，点击之后展开小面板，有三个选项“系统设置”“投影页面”“开发者后台”
除主页外每个页面都要加一个 < 返回，回到主页

07
我的要求是页面整体（注意是整体）是定死的16:10，不要边框不要滚动条禁止滚动，侧边栏右边的内容区，我可以允许它滚动，但也不允许有滚动条。
页面不要有一个白边框，不要有滚动条，禁止滚动禁止缩放，而且要注意右侧页面内容与侧边栏的间距，但不是让你去掉侧边栏的意思。最外面这个框要像定死了一样一动不动

08
现在的UI（16:10无滚动无缩放）和视频流畅处理并播放是我需要的，根据这一个版本以及我前面的要求写一个总结
ai写的总结如下：
系统架构描述
1.技术栈
后端 (Backend): Python 3.10+ / Flask / Flask-SocketIO (Threading 模式)
前端 (Frontend): Vue 3 / Nuxt 3 / Socket.io-client
算法引擎 (AI Engine):
DeepFace: 用于主导情绪识别。
MediaPipe: 用于面部 468 关键点追踪与 ROI (额头) 锁定。
OpenCV: 视频帧流式处理与信号预处理。
核心模块说明
tablet_processor.py：
_capture：多线程抓取原始帧。
_analyze：调用 DeepFace 每 0.5s 判别一次 dominant_emotion。
get_ui_data：利用 MediaPipe 锁定额头 ROI 区域，提取绿色通道均值（rPPG 基础），并返回 Base64 图像。
app.py：
异步推送引擎：将处理后的 image 与 state 封装成 tablet_video_frame 事件。
2.数据流拓扑
采集层：通过手机 IP Webcam 或平板内置镜头推送 RTSP/HTTP 视频流。
处理层：TabletProcessor 线程池并发处理视频帧抓取、AI 情绪识别及 ROI 绿色通道均值提取。
传输层：后端以约 25FPS 的频率将编码后的 Base64 图像与 JSON 状态通过 WebSocket 协议推送到前端。
展示层：前端 Canvas/Img 标签实时渲染视频，UI 动态显示心率波动与情绪标签。
采集端：平板运行 IP Webcam，通过 HTTP/RTSP 推送原始视频流。
服务端 (PC)：
后端：Python (Flask + SocketIO) 负责 AI 运算（DeepFace + MediaPipe）。
前端：Nuxt 3 负责 UI 渲染与交互逻辑。
通讯协议：WebSocket (SocketIO) 实现低延迟画面推送与状态同步。
3.计划
rPPG 算法增强：引入带通滤波器（Bandpass Filter）处理心率信号，从简单的绿色通道均值演进为真正的频率分析提取。
情绪平滑处理：引入滑动窗口（Sliding Window）投票机制，消除单帧情绪跳变引发的 UI 闪烁。
信号平滑：引入滑动平均滤波（Moving Average Filter），解决心率数值抖动。
若 AI 监测到老人产生“愤怒”或“挫败”情绪，系统自动降低训练难度或由 Akon 助手介入安抚
Akon 助手智能化：接入大语言模型 (LLM)，使长者能通过语音与助手进行情感交流。
4.注意
Windows 兼容性：由于 VSCode 调试器限制，SocketIO 必须使用 async_mode='threading' 以防止死锁。
画面比例：前端所有新页面必须包含在 app.vue 的 .tablet-frame 内，严禁手动修改 overflow 属性。
性能建议：DeepFace 识别频率控制在 0.5s 一次，避免 CPU 占用过高导致视频流延迟。
性能阈值：DeepFace 识别非常耗 CPU，严禁在 stream_worker 循环中直接调用识别函数，必须在独立线程中异步更新状态。

09
接下来，我们把手机摄像头和打地鼠认知训练加进来。要求是：要新加一个投影vue，这个vue平时会全黑只留一个白圈显示在我的电脑浏览器（待机状态），我会用手机拍电脑的屏幕上这个页面，，当我在平板上点击：益智→“认知训练”→打地鼠，就发一个信号，让这个vue知道等一下要显示的是打地鼠游戏，而平板点击完之后，会显示：平均反应速度+正确率，心率、情绪、疲劳程度、当前难度（分5级）等等信息，以及暂停和退出游戏按钮。我用手机拍电脑的页面，最开始是待机状态，显示一个白圈，我将右手食指放在圈内，手在这个区域满1秒，进度环就变成完整的100%的圆环，代表开始游戏。开始后页面上有三个地鼠洞，当我的手（特别是食指的位置）在某一个地鼠洞的范围内时，这个地鼠洞会有一个从0度到360度的进度环，如果手在这个区域满1秒，进度环就变成完整的100%的圆环，代表我选中这个洞，此时如果洞里有地鼠就显示绿色并加分，否则红色扣分。

10
投影页面最上方应该是一个“两分钟”的倒计时，以及显示玩家当前的得分，每打中一个地鼠加10分，答错扣5分。地鼠洞可以大一点，地鼠停留可以久一点点，
现在的手指是否在圈内的判断还不够准确，我理解的是，先识别三个地鼠洞的区域，然后识别手和食指，看食指在不在区域内。我希望能把识别区域和手的视频也显示在开发者页面上，开发者页面也是独立的页面，不要侧边栏和akon，16:9的1920*1080，但是可以有滚动，会有一上一下两个巨大的视频框，上面显示平板摄像头的处理画面，下面显示外接摄像头的处理画面。投影页面的入口也加到现在开发者后台那个地方去（现在是点击张爷爷会展开“开发者后台”、系统设置、退出登录，加一个“投影页面”）
地鼠停留久一点点的意思是，手指的识别是一秒，那地鼠从出现到消失应该是2.5秒左右，这样才反应得过来，因为把手放在区域内+更换遮挡不同区域+机器识别手+机器识别是否在这个区域加起来的时间可能两秒是不够的

11
现在akon那个悬浮球默认位置在平板上看有些超出屏幕外了，需要把初始位置默认定在右边正中间，默认只露出一半且50%透明度，随便拖动它它还会自己就近吸附到两边去，恢复成默认状态。

12
益智界面应该是多个游戏（如色词测试、打地鼠等等），点击之后打地鼠，投影界面是“纯黑的待机状态，中间有一个白圈，手放在圈内1s，进度变成100%后，游戏正式开始，而不是在平板上点开始。然后，变成白底，上方倒计时和得分，下方是三个地鼠洞，开始有地鼠出现，倒计时结束后，先显示一个：太棒了，最终得分xxx，然后变回黑屏+白圈的形式，如果再放在圈内1s，就再开始一次游戏。平板上只要有一个暂停游戏和退出游戏按钮就行了（最上方），还有其他信息的展示。
现在因为akon是半个，所以点它它没反应，不会弹出面板，应该是：当akon在屏幕两边是半个的时候，点击它，它会向内移动变成整个，再点一下就弹出面板（同时akon消失），关闭面板时akon出现，又变成半个半透明的状态
开发者页面应该是可以滚动的

13
现在你这种识别形式（提前预设3个框，判断手指在框内）是可以的（最好是三个圆而非框），但是，识别和显示太卡了且不准，识别速度特别慢，视频显示非常卡顿，这种游戏控制延迟是最重要的，我需要手在地鼠洞上就开始加载进度圈，手指拿开就能进度圈立刻消失的流畅体验。现在我的手已经离开画面，进度圈还在，导致一直在扣分，我需要的是高效流畅准确的识别与呈现

现在projection页面，大小是有问题的，只有当我的浏览器显示大小缩放到80%才刚刚好，而我需要的是居中的撑满屏幕的固定的显示。

training页面，应该在最上方显示当前游戏状态（待机/运行）以及大的暂停按钮和大的退出按钮。倒计时是不需要显示的，要显示的是当前难度（挑战、提升、正常、休闲、简单）实时心率+心率图+运动量（负荷/活动量）+情绪（中文显示）+情绪变化图+参与意愿（综合以上因素得出）

现在akon的拖动非常卡顿，不是流畅的拖动体验。而点击它应该先透明度变成100并向屏幕中心移动一小段距离恢复成完整的显示，与此同时，面板弹出，akon出现在面板上，悬浮球消失，而现在直接就消失。状态 ：空闲，静止在屏幕边缘，只露出 50%，透明度：50%，弱阴影。状态：唤醒 / 被点击，自动滑入完整圆形，动画，透明度：100%，状态：拖拽中，松手后自动吸附到最近边缘。面板关闭后：悬浮球 自动回到最近边缘，恢复半隐藏 + 半透明状态。我需要的是长时间无交互，自动贴边，但与之交互时，它会是完整的圆形态，并且点击它有一种akon从悬浮球优雅移动到面板上的感觉。

14
游戏的数据要保存，因为后面会加人脸识别，不同的人的数据要分开保存，这个数据一部分会显示在健康health页面（活动量、心率、hrv、情绪健康、灵活度等等）一部分显示在leaning益智页面，显示认知状态、直观展示认知训练效果。

15
提问：
平板页面在最上方显示当前游戏状态（待机/运行）以及在最上方有一个大的暂停按钮和一个大的退出按钮。倒计时是不需要显示的，要显示的是当前难度（挑战、提升、正常、休闲、简单）实时心率+心率图+运动量（负荷/活动量）+情绪（中文显示）+情绪变化图+参与意愿（综合以上因素得出）
想要的效果是，投影界面平时是“纯黑的休眠状态，什么都没有，纯黑。当我点进一个游戏后，投影界面中间有一个白圈，手放在圈内1s，进度变成100%后，游戏正式开始，此时平板界面应该先显示“请进入目标区域开始游戏”。当我手放在圈内1s后，投影界面正式显示地鼠游戏内容，平板页面显示这些信息

输出规范
1.安全性与合规性：安全词规避：代码注释与描述中不直接使用触发 AIGC 安全机制的敏感词（如“监控”、“老人”、“医疗”等），改用“状态感知”、“受众”、“健康干预”等中性表达。
2.输出代码之前先说明请修改“xxx的部分”代码/请用下面的代码完整替换，避免我直接完整替换，结果导致代码不完整。要准确告诉我是完整替换还是改哪里，不要出现在附近增加/请增加这种模糊的，需要告知我准确的位置，或者把某个部分完整替换。
3.回答的最后要提供一段“README 开发日志”，记录本次的修改点、解决的问题以及后续计划。

ai回答：
修改点： 增加了对 game_control 指令的监听，整合了状态感知的反馈逻辑，确保平板与投影状态同步。
修改点： 顶部新增状态标签与大型控制按钮；移除倒计时；新增难度、心率图、运动负荷、中文情绪及参与意愿显示。
修改点： 实现 is-sleep 纯黑逻辑，以及基于状态机的分层显示（纯黑 -> 白圈进度 -> 游戏内容）。

16
1.现在基本上是可用的，存在的问题是，你没改之前，视频是流畅显示的，现在视频会卡顿，而且是会有很久的延迟
但屏幕上地鼠和实时情绪是实时的，所以说明处理和显示分开是有用的，现在要解决的就是视频显示的问题
[http @ 0000015a15228280] Stream ends prematurely at 433063423, should be 18446744073709551615，这个原因是我把手机视频关了但这应该也反应了一个问题，为什么开发者页面视频很卡而且不实时，而我一刷新就又同步了，应该是堆积了太多没显示所以很卡很延迟。
2.暂停按钮无效，页面上地鼠依然在动，我希望投影页面正式游戏时是白底的，上方显示游戏倒计时条和分数，手指放上去也是0°到360°的0到100%的进度白圈而非现在的形式，对了圈就变绿，错了就变红。我想要按暂停之后，正式游戏的倒计时停止，地鼠洞消失，出现“已暂停”三个大字。可以去平板上点继续。
3.现在training不能滚动所以下面图表信息显示不全，说明你还是没理解我的意思，我的意思是health.vue等界面被包括在一个不可滚动缩放无边框的带侧边栏的容器里，但容器里右边的各个页面可以滚动（就像现在的setting页面可以滚动一样）不能显示滚动条。而且没有显示我要的心率图和情绪变化图
4.现在在电脑上实现了我要的akon的点击和拖动效果，但放在平板上时，就很僵硬和卡顿。而且当我交互的时候比如点击按钮什么的，会有一个蓝色的反馈，在安卓平板浏览器上，拖动akon时也是，有一个蓝色的按下反馈，要把这个去掉并解决平板上akon点击拖动的问题。
ai回答：
流媒体优化：在 app.py 引入了 25fps 的频率限制逻辑。通过主动丢帧机制，解决了由于局域网阻塞导致的视频流延迟和堆积问题，确保“视频流畅且逻辑实时”。
暂停机制完备化：在 games.py 引入了时间补偿算法，暂停时暂停所有 timer 逻辑，并在恢复时补回时间差。
沉浸式投影 UI：重构了 projection.vue，背景切换为白底，环形判定条通过 stroke-dasharray 动态计算，并实现了基于当前地鼠索引的“绿/红”颜色视觉反馈。
布局滚动修正：修正了平板 training.vue 的 CSS，采用 overflow-y: auto 结合隐藏滚动条的技术，解决了 16:10 比例下内容显示不全的问题。
平板交互优化：通过 translate3d 硬件加速和 touch-action: none 彻底消除了 Akon 在安卓平板上的卡顿和蓝色点击高亮框。

17
页面分为三个状态，休眠（未点进具体的游戏）待机（等待手进入黑底白圈里）游戏中（白底游戏）游戏结束回到待机状态。
1.投影界面平时是“纯黑的休眠状态，什么都没有，纯黑。
2.当我点进一个游戏后进入待机状态，此时平板界面应该先显示“请进入目标区域开始游戏”。只要显示这一句话，显示在平板中间，字要大 。+还要显示游戏状态：待机 以及一个 退出按钮 。不要显示当前难度、心率这些。此时投影界面还是黑底的，但是中间出现一个白圈
3.黑底白圈，手放在圈内1s，进度变成100%后，游戏正式开始，界面变成白底，此时平板界面应该先显示“请进入目标区域开始游戏”。当我手放在圈内1s后，投影界面正式显示地鼠游戏内容（地鼠游戏白底），平板页面显示心率等信息
4.游戏结束，显示最终结果，恢复到待机状态（黑底+一个白圈）
新增要求，当点进去具体游戏时，此时点侧边栏会失效，点击会有提示：请先退出游戏。
去掉开发者页面的系统日志，也就是一直在更新的“game状态更新”，它一直在疯狂增加，应该也会导致页面卡顿
ai回答：
结构完整性回溯：彻底恢复了 side-nav 原始 HTML 结构，确保侧边栏宽度、位置、交互区域与初始版本完全一致。
16:10 布局算法修正：改用 width: 100vw; height: 62.5vw 的自适应计算公式。这种方法比 aspect-ratio 更兼容平板 WebView，能有效解决四周出现白边或黑框的问题。
侧边栏锁定机制：在不改变样式的前提下，通过 isGameActive 状态控制 NuxtLink 的 to 属性。游戏时跳转目标设为空，点击无反应并弹出警告。
Akon 卡顿深度治理：
移除了 ball.x 位移上的 transition 动画（仅保留透明度动画），因为拖拽时的 CSS 过渡是卡顿的主要元凶。
引入 translate3d 强制开启 GPU 复合层渲染。
使用 touchstart.passive: false 确保拖动指令能被实时捕获，不被浏览器延迟。

18
本次针对“阿康助手智能化”进行了详细的技术调研与方案设计。新增计划：
本地语音交互模块：确定采用 Ollama (Qwen2.5-3B) 作为语言核心，Llava-Phi-3 作为视觉核心，Faster-Whisper 用于识别，Piper-TTS 用于语音合成。该方案完全免费、本地化，适配 RTX 3050Ti (4GB VRAM) 硬件。
记忆机制设计：设计了基于 JSON/SQLite 的轻量级记忆存储方案，将用户的喜好、历史对话记录注入 LLM 的 Context 中，实现“记住用户喜好”的功能。
多模态能力：规划了通过 Llava-Phi3 模型分析平板摄像头截帧或投影画面截图，实现“看图说话”和基于视觉的情感/状态判断（例如：“爷爷看起来有点累”）。
硬件适配分析：
确认在 4GB 显存限制下，使用 4-bit 量化技术可以流畅运行 Qwen2.5-3B 和 Llava-Phi3，显存占用控制在 4GB 以内，不会与现有的视频流处理冲突。
接下来计划：
在 backend 目录下新建 akon_agent.py，实现简单的“按键说话”Demo，验证 TTS 和 LLM 的连通性。
编写 Prompt 模板，定义阿康的人设（温暖、耐心、适老化）。
逐步接入 sherpa-onnx 实现离线唤醒词检测。

